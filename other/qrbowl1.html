<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–º—É–ª—è—Ç–æ—Ä –í–æ—Ä–æ–Ω–∫–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="font-sans flex flex-col items-center p-5 bg-gray-100">

    <header class="bg-blue-600 text-white p-4 text-center mb-8 rounded-md shadow-md w-full max-w-lg">
        <h1 class="text-3xl font-bold">bowlmates.club</h1>
    </header>

    <div class="container bg-white p-8 rounded-lg shadow-md text-center mb-5">
        <h1 class="text-2xl text-gray-800 mb-4">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h1>
        <input type="number" id="userResult" placeholder="–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mb-4">
        <button onclick="checkResult()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
    </div>

    <div id="result-window" class="container bg-white p-8 rounded-lg shadow-md text-center mb-5 hidden">
        <h2 class="text-xl text-gray-800 mb-4">–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</h2>
        <p id="result-comparison" class="text-gray-700">–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ª—É—á—à–µ, —á–µ–º —É <span id="percentage" class="font-semibold"></span>% –∏–≥—Ä–æ–∫–æ–≤!</p>
        <button onclick="showOtherResults()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-4">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥—Ä—É–≥–∏—Ö</button>
    </div>

    <div id="results-others" class="container bg-white p-8 rounded-lg shadow-md text-center mb-5 hidden">
        <h2 class="text-xl text-gray-800 mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h2>
        <table id="other-results-table" class="w-full border-collapse mt-2 overflow-y-auto max-h-48">
            <thead>
                <tr>
                    <th class="border border-gray-300 p-2 bg-gray-200 font-bold text-left">–ò–º—è</th>
                    <th class="border border-gray-300 p-2 bg-gray-200 font-bold text-left">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <button onclick="showModal()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-4">–ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —É—á–∞—Å—Ç–∏–µ</button>
    </div>

    <div id="offerModal" class="modal hidden fixed z-10 left-0 top-0 w-full h-full overflow-auto bg-gray-900 bg-opacity-25">
        <div class="modal-content bg-white m-auto mt-40 p-6 border border-gray-400 rounded-lg text-center w-4/5 md:w-1/2">
            <span class="close-button absolute top-0 right-0 text-gray-600 hover:text-gray-900 text-2xl font-bold p-2 cursor-pointer" onclick="closeModal()">&times;</span>
            <h2 class="text-xl text-gray-800 mb-4">–ú—ã –ø—Ä–∏–≥–ª–∞—à–∞–µ–º —Ç–µ–±—è –ø–æ–∏–≥—Ä–∞—Ç—å —Å –Ω–∞–º–∏ –≤ –¥—Ä—É–∂–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ –º–∏–Ω–∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è! ü§ù</h2>
            <p class="text-gray-700 mb-4">2 —á–∞—Å–∞ –∏–≥—Ä—ã / 6 –∏–≥—Ä / 3 —Ä–∞–∑–Ω—ã—Ö —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ + —Å–æ–≤–µ—Ç—ã –æ—Ç –ø—Ä–æ—Ñ–∏ —Ç—Ä–µ–Ω–µ—Ä–∞ üéØ</p>
            <p class="text-gray-700 mb-4">–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –º–∏–Ω–∏-—Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ WhatsApp: üëá</p>
            <div class="mb-4">
                <a href="https://wa.me/381629308735" target="_blank" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline inline-block">–ù–∞–ø–∏—Å–∞—Ç—å –≤ WhatsApp</a>
            </div>
            <div class="flex justify-center space-x-4 mt-2">
                <a href="https://instagram.com/bowling_subotica" target="_blank" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline inline-block">Instagram</a>
                <a href="https://t.me/anatoly_bowling" target="_blank" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline inline-block">Telegram</a>
            </div>
        </div>
    </div>

    <script>
        let sheetData = []; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets
        let modalShown = false; // –§–ª–∞–≥, —á—Ç–æ–±—ã –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é
        let userResultRow; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è DOM —ç–ª–µ–º–µ–Ω—Ç–∞ —Å—Ç—Ä–æ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let modalTimer; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞

        document.addEventListener('DOMContentLoaded', function() {
            fetchData(); // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        });

        function fetchData() {
            const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ097fHhFOH3v_RYrE-IRuD2GWy-ZoI7dgv38IG-tmUzBZJIlxVl6bljhcHm_3tyrdIk7_clVL6WnkB/pub?gid=659161648&single=true&output=csv';

            fetch(csvUrl)
                .then(response => response.text())
                .then(csvText => {
                    sheetData = parseCSV(csvText);
                    console.log('–î–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', sheetData);
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error));
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',');
            let data = [];

            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i].split(',');
                if (currentLine.length === headers.length) { // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏
                    let obj = {};
                    for (let j = 0; j < headers.length; j++) {
                        obj[headers[j].trim()] = currentLine[j].trim(); // trim –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–±–µ–ª–æ–≤
                    }
                    data.push(obj);
                }
            }
            return data;
        }


        function checkResult() {
            const userResult = parseFloat(document.getElementById('userResult').value);
            if (isNaN(userResult)) {
                alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.");
                return;
            }

            if (!sheetData || sheetData.length === 0) {
                alert("–î–∞–Ω–Ω—ã–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
                return;
            }

            let betterThanCount = 0;
            sheetData.forEach(row => {
                const avgValue = parseFloat(row['AVG']); // –ò—Å–ø–æ–ª—å–∑—É–µ–º 'AVG' –∫–∞–∫ –∏–º—è –∫–æ–ª–æ–Ω–∫–∏
                if (!isNaN(avgValue) && userResult > avgValue) {
                    betterThanCount++;
                }
            });

            const percentage = ((betterThanCount / sheetData.length) * 100).toFixed(0);
            document.getElementById('percentage').textContent = percentage;
            document.getElementById('result-window').classList.remove('hidden');
            document.getElementById('result-window').classList.add('block');
        }

        function showOtherResults() {
            const resultsOthersDiv = document.getElementById('results-others');
            const otherResultsTableBody = document.querySelector('#other-results-table tbody');
            const userResult = parseFloat(document.getElementById('userResult').value);

            otherResultsTableBody.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            modalShown = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–æ–∫–∞–∑–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

            // 1. –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userResultData = {
                'Name': '–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–í—ã)', // –∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ –∏–º—è
                'AVG': userResult.toString() // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ AVG - —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏, –∏–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ Number –ø–æ–∑–∂–µ
            };

            // 2. –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const combinedData = [...sheetData, userResultData];

            // 3. –°–æ—Ä—Ç–∏—Ä—É–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ 'AVG' –≤ —É–±—ã–≤–∞—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ
            const sortedData = combinedData.sort((a, b) => parseFloat(b['AVG']) - parseFloat(a['AVG']));

            // 4. –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            sortedData.forEach(row => {
                let tr = document.createElement('tr');
                let nameTd = document.createElement('td');
                let avgTd = document.createElement('td');

                nameTd.textContent = row['Name'];
                avgTd.textContent = row['AVG'];
                tr.appendChild(nameTd);
                tr.appendChild(avgTd);

                // 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ —Å—Ç—Ä–æ–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—ã–¥–µ–ª—è–µ–º –µ–µ
                if (row === userResultData) { // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –æ–±—ä–µ–∫—Ç—ã, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏—è
                    tr.classList.add('user-result', 'font-bold', 'text-green-500', 'bg-green-100');
                    nameTd.classList.add('font-bold', 'text-green-500', 'bg-green-100');
                    avgTd.classList.add('font-bold', 'text-green-500', 'bg-green-100');
                    userResultRow = tr; // –°–æ—Ö—Ä–∞–Ω—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä–æ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    userResultRow.id = 'user-result-row'; // –î–æ–±–∞–≤–ª—è–µ–º ID –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
                }
                 tr.classList.add('border', 'border-gray-300');
                 nameTd.classList.add('p-2', 'text-left');
                 avgTd.classList.add('p-2', 'text-left');


                otherResultsTableBody.appendChild(tr);
            });


            document.getElementById('result-window').classList.remove('block');
            document.getElementById('result-window').classList.add('hidden');
            resultsOthersDiv.classList.remove('hidden');
            resultsOthersDiv.classList.add('block');

            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫—Ä–æ–ª–ª–∞ –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–ª–æ–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            if (!modalTimer) { // –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ç–∞–π–º–µ—Ä–æ–≤
                modalTimer = setTimeout(checkUserResultVisibility, 2000); // –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ 2 —Å–µ–∫—É–Ω–¥—ã
            }

        }

        function isElementInViewport(el) {
            if (!el) return false; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null –∏–ª–∏ undefined
            const rect = el.getBoundingClientRect();
            return (
                rect.top >= 0 &&
                rect.left >= 0 &&
                rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                rect.right <= (window.innerWidth || document.documentElement.clientWidth)
            );
        }

        function checkUserResultVisibility() {
            if (!modalShown && isElementInViewport(userResultRow)) {
                showModal();
                modalShown = true;
                clearTimeout(modalTimer); // –û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–π–º–µ—Ä, —á—Ç–æ–±—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª —Å–Ω–æ–≤–∞
                modalTimer = null; // –°–±—Ä–æ—Å–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–π–º–µ—Ä–∞
            } else {
                modalTimer = null; // –°–±—Ä–æ—Å–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–π–º–µ—Ä–∞, –µ—Å–ª–∏ –Ω–µ –≤ viewport (–¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏)
            }
        }


        function showModal() {
            document.getElementById('offerModal').classList.remove('hidden');
            document.getElementById('offerModal').classList.add('block');
            // document.getElementById('results-others').classList.remove('block');
            // document.getElementById('results-others').classList.add('hidden');
        }

        function closeModal() {
            document.getElementById('offerModal').classList.remove('block');
            document.getElementById('offerModal').classList.add('hidden');
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            if (event.target == document.getElementById('offerModal')) {
                closeModal();
            }
        }
    </script>

</body>
</html>
